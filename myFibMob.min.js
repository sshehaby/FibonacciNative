var TIM,base,anim=null,myAnym=null,runIt=!0,backGrCol="#7395ae",already="#8bb39f";function foo(){return void 0===foo.counter&&(foo.counter=0),foo.counter++,foo.counter}var width,height,canvas,context,lastID=null;class MyAnim{constructor(){this.animID=foo(),lastID=this.animID,this.anim=null,runIt=!0,console.log("New Anim "+this.animID)}static reset(){anim&&(runIt=!1,window.cancelAnimationFrame(anim),anim=null)}set(e,t=1,a=0){if(tree){anim&&MyAnim.reset(),TIM=parseInt(1e3*t);var r=Date.now(),o=0,n=0,l=(a=a,this.animID),i=function(){if(!(l<lastID)){if(x=Date.now(),x-r>TIM&&(console.log("2"),r=x,tree.arrayNodesXX.length)){var e=tree.arrayNodesXX[0];if(!e)return drawNodeWithScale(tree.root),void tree.arrayNodesXX.shift();tree.arrayNodesXX.shift();var t,a=e.node;drawNodeWithScale(a,e.color,e.text),console.log(a.data+"  "+e.color+" "+e.text),e.fib&&clearElement(e.fib[0],e.fib[1],e.fib[2]),t=(o=1-o)?tree.root.colors[1]:"red",context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),Node.drawNode(tree.root,t,base),context.restore()}runIt&&window.requestAnimationFrame(i)}},s=function(){if(!(l<lastID)){if(x=Date.now(),x-r>TIM){if(n++,a&&n>a)return n=0,runIt=!1,window.cancelAnimationFrame(anim),anim=null,void f1();var e;r=x,e=(o=1-o)?"#fce6e6":"#e6baba",context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),Node.drawNode(tree.root,e),context.restore()}runIt&&window.requestAnimationFrame(s)}};anim=0==e?s:i,runIt=!0,window.requestAnimationFrame(anim)}}}var key,interval=window.setInterval(function(){},1e3);function f1(){divFlag||(MyAnim.reset(),console.log("World!"),tree.computeTerminals(),context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),tree.drawAllNodes(),context.restore())}function waitThenDo(e,t){setTimeout(()=>{t()},e)}function computeXYParent(e){var t=[];!function e(a,r,o,n=0){a&&(a.extra=r,a.depth=n,e(a.left,r-o,o/4,n+1),e(a.right,r+o,o/4,n+1),t.push(a))}(e,0,1),t.sort(function(e,t){return e.extra>t.extra?1:t.extra>e.extra?-1:0}),function(){var e,a=-parseInt(t.length/2);for(e=0;e<t.length;e++)t[e].extra=a++}()}var addHV=function(e,t,a,r,o=0){e&&(e.parent?(e.x=t+e.extra*(r+o),e.y=a+3*e.depth*r):(e.x=t+20*e.extra,e.y=a),e.r=r,addHV(e.left,t,a,r,o),addHV(e.right,t,a,r,o))},tree=null,Radius=20,Style=0,Delta=10,myarr=null;function createFibTree(){runIt=!1,anim&&(MyAnim.reset(),console.log("resetx"));var e=new MyAnim;if(canvas=document.getElementById("my-canvas"),context=canvas.getContext("2d"),width=canvas.width,height=canvas.height,context.fillStyle=backGrCol,context.fillRect(0,0,width,height),context.beginPath(),scale=parseFloat(document.getElementById("myRange").value/100),context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),context.font="bold 20px Courier New",x=document.getElementsByName("DrawingStyle"),Style=x[0].checked?0:1,Delta=parseInt(document.getElementById("delta").value),isNaN(Delta)||Delta<0)return alert("Enter a number >=0"),void(document.getElementById("delta").value=10);if(divFlag=!1,document.getElementById("dq").disabled=!1,document.getElementById("dq").style.background="#89b7d9",document.getElementById("mm").disabled=!1,document.getElementById("dp").disabled=!1,document.getElementById("mm").style.background="#89b7d9",document.getElementById("dp").style.background="#89b7d9",MyAnim.reset(),input=document.getElementById("base"),document.getElementById("base").scrollIntoView({behavior:"smooth",inline:"center",block:"center"}),base=parseInt(input.value),isNaN(base)||base<1)return alert("Enter a number >0"),void(input.value=5);var t=parseFloat(document.getElementById("RefTime1").value);if(isNaN(t)||t<0||t>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime1").value=1);var a=parseFloat(document.getElementById("Time1").value);if(isNaN(a)||a<1||a>30)return alert("Enter a number >=1 and <30"),void(document.getElementById("Time1").value=10);for((tree=new Tree(base)).createTree(),Style?(computeXYParent(tree.root),addHV(tree.root,width/2,80,Radius,Delta)):computeGeometry(tree.root,width/2,80,Radius,0),Tree.drawLines(tree.root),tree.drawAllNodes(),context.restore(),console.log("Len:"+tree.arrayNodes.length);tree.stopWatch;);e.set(0,t,a)}function repTree(){if(tree){var e=document.getElementsByName("DrawingStyle");Style=e[0].checked?0:1,Delta=parseInt(document.getElementById("delta").value),Style?(computeXYParent(tree.root),addHV(tree.root,width/2,80,Radius,Delta)):computeGeometry(tree.root,width/2,80,Radius,0),doSome()}}function doSome(){if(tree){var e=null;lastTable&&(e=context.getImageData(lastTable[0]-1,lastTable[1]-1,lastTable[2]+2,lastTable[5]+2)),scale=parseFloat(document.getElementById("myRange").value/100),context.fillStyle=backGrCol,context.fillRect(0,0,width,height),context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),context.beginPath(),Tree.drawLines(tree.root),tree.drawAllNodes(),console.log("xxx"),context.restore(),lastTable&&context.putImageData(e,lastTable[0]-1,lastTable[1]-1)}}function drawCircleText(e,t,a,r,o,n="black"){context.beginPath(),context.arc(e,t,a,0,2*Math.PI),context.fillStyle=r,context.fill(),context.stroke(),context.closePath(),context.font="bold 20px Courier New";var l=o.toString(),i=context.measureText(l);e=parseInt(e-i.width/2),t=parseInt(t-(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent-a)),context.fillStyle=n,context.fillText(l,e,t)}function drawArr(e,t,a,r,o,n,l,s=!0){if(e)for(i=0;i<e.length;i++)e[i][0].destroy();var d=t.length,c=[];for(s&&(a=parseInt(width/2-d*o/2)),i=0;i<d;i++)c.push([drawRectangleText(a,r,o,n,l,t[i],"black"),a,r,o,n]),a+=o;return c}function hideArray(e){var t;if(e)for(t=0;t<e.length;t++)e[t][0].hide()}function showArray(e){var t;for(t=0;t<e.length;t++)e[t][0].show()}function redrawArr(e,t,a){var r=e[1],o=e[2],n=e[3],l=e[4];return e[0].destroy(),[drawRectangleText(e[1],e[2],e[3],e[4],a,t,"black"),r,o,n,l]}function drawRectangleText(e,t,a,r,o,n,l){var i=new Konva.Group({x:e,y:t,width:a,height:r,rotation:0});return i.add(new Konva.Rect({width:a,height:r,fill:o,stroke:"black"})),i.add(new Konva.Text({text:n,fontSize:24,fontFamily:"Calibri",fill:l,width:a,padding:5,align:"center"})),group.add(i),tr.forceUpdate(),layer.draw(),console.log(i.width()),i}class Node{constructor(e,t){this.left=null,this.right=null,this.parent=t,this.depth=0,this.extra=0,this.shape=null,this.data=e,this.value=-1,this.status=0,this.touch=!1,this.colors=["#fce6e6","#b0d0e8","#cdf7ee",already],this.x=0,this.y=0,this.r=0}static drawNode(e,t=null,a=null){var r=e.data;-1!=e.value&&(r=e.value),a||(a=r),t||(t=e.colors[e.status]),e.shape=drawCircleText(e.x,e.y,e.r,t,a,"black")}static getColor(e){return e.colors[e.status]}static changeColor(e,t){e.shape[0].fill(t)}static changeText(e,t){var a=e.shape[1];console.log("YYYYYYYYYYYYY"+a.x()+" "+e.x+" "+e.r);var r=e.x-(t<10?e.r/4:e.r/2);a.x(r),a.text(t)}}class Tree{constructor(e){var t;for(this.num=e,this.root=null,this.count=0,this.stopWatch=!0,this.array=[],this.array.length=e,this.arrayNodes=[],this.arrayNodesXX=[],this.status=0,t=0;t<e;t++)this.array[t]=-1}computeTerminalsX(e=this.root){e&&(e.data<2?(e.value=1,e.status=2,e.touch=!0):(e.value=-1,e.status=0,e.touch=!0),this.computeTerminalsX(e.left),this.computeTerminalsX(e.right))}computeTerminals(){this.computeTerminalsX(tree.root),tree.status=1}children(e,t){return e?(this.arrayNodes.push(e),t>=2?(e.left=new Node(t-2,e),this.children(e.left,t-2),this.count++):e.left=null,t>=1?(e.right=new Node(t-1,e),this.children(e.right,t-1),this.count++,e):e.right=null):null}createTree(){var e=this.num;this.root=new Node(e,null),this.count=1,this.children(this.root,e),console.log(this.count);var t=getAllNodes(this.root,0);console.log(t)}static getDepth(e){if(!e)return 0;var t=Tree.getDepth(e.left),a=Tree.getDepth(e.right);return t>a?t+1:a+1}drawAllNodes(){Tree.drawNodes(this.root,null),this.stopWatch=!1}static drawNodes(e,t){if(e){Node.drawNode(e);Tree.drawNodes(e.left,e),Tree.drawNodes(e.right,e)}}static drawLine(e,t,a,r){var o=e,n=t+Radius,l=a,i=r-Radius;context.beginPath(),context.moveTo(o,n),context.lineTo(l,i),context.stroke(),context.closePath()}static drawLines(e,t=null){if(e){var a=t;a&&Tree.drawLine(a.x,a.y,e.x,e.y),Tree.drawLines(e.left,e),Tree.drawLines(e.right,e)}}}function getAllNodes(e,t){switch(t){case 0:var a="In---Order : ";!function e(t){t&&(e(t.left),a+=t.data.toString()+"  ",e(t.right))}(e);break;case 1:a="Pre--Order : ";!function e(t){t&&(a+=t.data.toString()+"  ",e(t.left),e(t.right))}(e);break;case 2:a="Post-Order : ";!function e(t){t&&(e(t.left),e(t.right),a+=t.data.toString()+" ")}(e);break;case 77:a=[];!function e(t){t&&(e(t.left),e(t.right),t.data>1&&a.push(t))}(e)}return a}function travPreorder(e){var t="Pre--Order : ";return function e(a){a&&(t+=a.data.toString()+"  ",e(a.left),e(a.right))}(e),t}var leftCoordinate=function(e,t,a,r){delta=Math.pow(1.7,10-r)+2*a;Math.pow(2,r-1);return{cx:e-delta,cy:t+3*a}},rightCoordinate=function(e,t,a,r){delta=Math.pow(1.7,10-r)+2*a;Math.pow(2,r-1);return{cx:e+delta,cy:t+3*a}},computeGeometry=function(e,t,a,r,o){if(e){if(e.x=t,e.y=a,e.r=r,e.depth=o,e.left){var n=leftCoordinate(t,a,r,o);computeGeometry(e.left,n.cx,n.cy,r,o+1)}if(e.right){var l=rightCoordinate(t,a,r,o);computeGeometry(e.right,l.cx,l.cy,r,o+1)}}},drawAll=function(e,t){if(e){if(e.draw(),prevNode=t,prevNode)(new Line).draw(prevNode.getX(),prevNode.getY(),e.x,e.y,prevNode.getRadius(),e.ctx);drawAll(e.left,e),drawAll(e.right,e)}};class ColText{constructor(e,t,a,r=null){this.color=t,this.text=a,this.node=e,this.fib=r}}var dc=function(e){if(e){if(e.data<1)return tree.arrayNodesXX.push(new ColText(e,already,1)),e.value=1,e.status=3,1;e.status=1;var t=new ColText(e,Node.getColor(e),e.data);return tree.arrayNodesXX.push(t),e.value=dc(e.left)+dc(e.right),e.status=2,t=new ColText(e,Node.getColor(e),e.value),tree.arrayNodesXX.push(t),e.value}return 1},divFlag=!1,drawNodeWithScale=function(e,t=null,a=null){context.save(),context.translate(width/2*(1-scale),0),context.scale(scale,1),5==e.data&&console.log(e.value),Node.drawNode(e,t,a),context.restore()},divConq=function(){if(tree){clearArray(),divFlag=!0;var e=parseFloat(document.getElementById("RefTime2").value);if(isNaN(e)||e<0||e>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);for(tree.computeTerminals(),hideArray(myarr),myarr=null,i=0;i<tree.arrayNodes.length;i++){var t=tree.arrayNodes[i];t.touch&&(drawNodeWithScale(t),t.touch=!1)}if(tree.status){(new MyAnim).set(1,e),tree.arrayNodesXX=[];var a=tree.root;dc(a);var r=new ColText(tree.root,"green",tree.root.value);tree.arrayNodesXX.push(r),tree.arrayNodesXX.push(null)}else anim&&MyAnim.reset()}};tree=null;var fibArr,dcm=function(e){if(e){if(fibArr[e.data]>-1){e.value=fibArr[e.data];var t=new ColText(e,already,null);return tree.arrayNodesXX.push(t),e.status=3,e.value}if(e.data<1)return tree.arrayNodesXX.push(new ColText(e,already,1)),e.value=1,1;e.status=1;t=new ColText(e,Node.getColor(e),null);return tree.arrayNodesXX.push(t),e.value=dcm(e.left)+dcm(e.right),e.status=2,t=new ColText(e,Node.getColor(e),e.value,[e.data,already,e.value]),tree.arrayNodesXX.push(t),fibArr[e.data]=e.value,e.value}return 1},meMoise=function(){if(tree){divFlag=!0;var e=parseFloat(document.getElementById("RefTime2").value);if(isNaN(e)||e<0||e>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);for(tree.computeTerminals(),i=0;i<tree.arrayNodes.length;i++){var t=tree.arrayNodes[i];(t=tree.arrayNodes[i]).touch&&(drawNodeWithScale(t),t.touch=!1)}tree.status||anim&&MyAnim.reset(),tree.arrayNodesXX=[],(new MyAnim).set(1,e);var a=tree.root;for(fibArr=[1,1],i=2;i<=tree.num;i++)fibArr.push(-1);drawArray(context,fibArr,50,30,0,10,middle=!0,"red"),clearElement(0,col=already,text=fibArr[0]),clearElement(1,col=already,text=fibArr[1]),dcm(a),tree.arrayNodesXX.push(null)}},dynP=function(){if(tree){divFlag=!0;var e=parseFloat(document.getElementById("RefTime2").value);if(isNaN(e)||e<0||e>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);for(tree.computeTerminals(),tree.status||anim&&MyAnim.reset(),r=0;r<tree.arrayNodes.length;r++){var t=tree.arrayNodes[r];(t=tree.arrayNodes[r]).touch&&(t.data<2?(t.status=3,drawNodeWithScale(t,already)):drawNodeWithScale(t),t.touch=!1)}lastTable&&clearArray(),tree.arrayNodesXX=[],(new MyAnim).set(1,e);var a=tree.root;for(fibArr=[1,1],r=2;r<=tree.num;r++)fibArr.push(-1);drawArray(context,fibArr,50,30,0,10,middle=!0,"red"),clearElement(0,col=already,text=fibArr[0]),clearElement(1,col=already,text=fibArr[1]);var r,o=getAllNodes(tree.root,77);for(r=0;r<o.length;r++){a=o[r];if(fibArr[a.data]>-1){a.value=fibArr[a.data],a.status=3;var n=new ColText(a,already,a.value,[a.data,already,a.value]);tree.arrayNodesXX.push(n)}else a.value=a.left.value+a.right.value,a.status=2,n=new ColText(a,Node.getColor(a),a.value,[a.data,already,a.value]),tree.arrayNodesXX.push(n),fibArr[a.data]=a.value}tree.arrayNodesXX.push(null)}},lastTable=null,clearArray=function(e=null){lastTable&&(e||(e=backGrCol),context.fillStyle=e,context.fillRect(lastTable[0]-1,lastTable[1]-1,lastTable[2]+2,lastTable[5]+2),lastTable=null)},clearElement=function(e,t=null,a=null){lastTable&&(t||(t=backGrCol),context.fillStyle=t,context.fillRect(lastTable[0]+e*lastTable[4]+1,lastTable[1]+1,lastTable[4]-2,lastTable[5]-2),a&&writeTextAt(context,a,lastTable[0]+e*lastTable[4]+lastTable[4]/2,lastTable[3]))},drawArray=function(e,t,a,r,o,n,l=!1,s=null){e.font="bold 24px Courier New";var d=t.length,c=a*d,u=r,h=0;l&&(cw=document.getElementById("my-canvas").width,h+=parseInt((cw-c)/2),o=0),lastTable=[h+o,n,c,u+n,a,r],s&&clearArray(s),i=0;for(var m=0;m<=c;m+=a)e.moveTo(h+o+m,n),e.lineTo(h+o+m,u+n),i<d&&writeTextAt(e,t[i++],h+o+m+a/2,u+n);for(m=0;m<=u;m+=u)e.moveTo(h+o,m+n),e.lineTo(h+o+c,m+n);e.strokeStyle="black",e.stroke(),lastTable=[h+o,n,c,u+n,a,r]},writeTextAt=function(e,t,a,r){t=t.toString();var o=e.measureText(t);a=parseInt(a-o.width/2),r=parseInt(r-(o.actualBoundingBoxAscent-o.actualBoundingBoxDescent)/2),e.strokeText(t,a,r)};